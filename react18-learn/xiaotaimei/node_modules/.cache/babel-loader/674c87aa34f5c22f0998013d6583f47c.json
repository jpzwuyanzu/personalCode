{"ast":null,"code":"import { useClickAway } from 'ahooks';\nimport classNames from 'classnames';\nimport React, { cloneElement, useEffect, useRef, useState, forwardRef, useImperativeHandle } from 'react';\nimport Popup from '../popup';\nimport { ItemChildrenWrap } from './item';\nimport { withNativeProps } from '../../utils/native-props';\nimport { mergeProps } from '../../utils/with-default-props';\nimport { usePropsValue } from '../../utils/use-props-value';\nconst classPrefix = `adm-dropdown`;\nconst defaultProps = {\n  defaultActiveKey: null,\n  closeOnMaskClick: true,\n  closeOnClickAway: false\n};\nconst Dropdown = forwardRef((p, ref) => {\n  const props = mergeProps(defaultProps, p);\n  const [value, setValue] = usePropsValue({\n    value: props.activeKey,\n    defaultValue: props.defaultActiveKey,\n    onChange: props.onChange\n  });\n  const navRef = useRef(null);\n  const contentRef = useRef(null);\n  // 点击外部区域，关闭\n  useClickAway(() => {\n    if (!props.closeOnClickAway) return;\n    setValue(null);\n  }, [navRef, contentRef]);\n  // 计算 navs 的 top 值\n  const [top, setTop] = useState();\n  const containerRef = useRef(null);\n  useEffect(() => {\n    const container = containerRef.current;\n    if (!container) return;\n    if (value) {\n      const rect = container.getBoundingClientRect();\n      setTop(rect.bottom);\n    }\n  }, [value]);\n  const changeActive = key => {\n    if (value === key) {\n      setValue(null);\n    } else {\n      setValue(key);\n    }\n  };\n  let popupForceRender = false;\n  const items = [];\n  const navs = React.Children.map(props.children, child => {\n    if (React.isValidElement(child)) {\n      const childProps = Object.assign(Object.assign({}, child.props), {\n        onClick: () => {\n          changeActive(child.key);\n        },\n        active: child.key === value,\n        arrow: child.props.arrow === undefined ? props.arrow : child.props.arrow\n      });\n      items.push(child);\n      if (child.props.forceRender) popupForceRender = true;\n      return cloneElement(child, childProps);\n    } else {\n      return child;\n    }\n  });\n  useImperativeHandle(ref, () => ({\n    close: () => {\n      setValue(null);\n    }\n  }), [setValue]);\n  return withNativeProps(props, React.createElement(\"div\", {\n    className: classNames(classPrefix, {\n      [`${classPrefix}-open`]: !!value\n    }),\n    ref: containerRef\n  }, React.createElement(\"div\", {\n    className: `${classPrefix}-nav`,\n    ref: navRef\n  }, navs), React.createElement(Popup, {\n    visible: !!value,\n    position: 'top',\n    className: `${classPrefix}-popup`,\n    maskClassName: `${classPrefix}-popup-mask`,\n    bodyClassName: `${classPrefix}-popup-body`,\n    style: {\n      top\n    },\n    forceRender: popupForceRender,\n    onMaskClick: props.closeOnMaskClick ? () => {\n      changeActive(null);\n    } : undefined\n  }, React.createElement(\"div\", {\n    ref: contentRef\n  }, items.map(item => {\n    const isActive = item.key === value;\n    return React.createElement(ItemChildrenWrap, {\n      key: item.key,\n      active: isActive,\n      forceRender: item.props.forceRender,\n      destroyOnClose: item.props.destroyOnClose\n    }, item.props.children);\n  })))));\n});\nexport default Dropdown;","map":{"version":3,"names":["useClickAway","classNames","React","cloneElement","useEffect","useRef","useState","forwardRef","useImperativeHandle","Popup","ItemChildrenWrap","withNativeProps","mergeProps","usePropsValue","classPrefix","defaultProps","defaultActiveKey","closeOnMaskClick","closeOnClickAway","Dropdown","p","ref","props","value","setValue","activeKey","defaultValue","onChange","navRef","contentRef","top","setTop","containerRef","container","current","rect","getBoundingClientRect","bottom","changeActive","key","popupForceRender","items","navs","Children","map","children","child","isValidElement","childProps","Object","assign","onClick","active","arrow","undefined","push","forceRender","close","createElement","className","visible","position","maskClassName","bodyClassName","style","onMaskClick","item","isActive","destroyOnClose"],"sources":["/Users/xinyonghu/Desktop/personalCode/react18-learn/xiaotaimei/node_modules/antd-mobile/es/components/dropdown/dropdown.js"],"sourcesContent":["import { useClickAway } from 'ahooks';\nimport classNames from 'classnames';\nimport React, { cloneElement, useEffect, useRef, useState, forwardRef, useImperativeHandle } from 'react';\nimport Popup from '../popup';\nimport { ItemChildrenWrap } from './item';\nimport { withNativeProps } from '../../utils/native-props';\nimport { mergeProps } from '../../utils/with-default-props';\nimport { usePropsValue } from '../../utils/use-props-value';\nconst classPrefix = `adm-dropdown`;\nconst defaultProps = {\n  defaultActiveKey: null,\n  closeOnMaskClick: true,\n  closeOnClickAway: false\n};\nconst Dropdown = forwardRef((p, ref) => {\n  const props = mergeProps(defaultProps, p);\n  const [value, setValue] = usePropsValue({\n    value: props.activeKey,\n    defaultValue: props.defaultActiveKey,\n    onChange: props.onChange\n  });\n  const navRef = useRef(null);\n  const contentRef = useRef(null);\n  // 点击外部区域，关闭\n  useClickAway(() => {\n    if (!props.closeOnClickAway) return;\n    setValue(null);\n  }, [navRef, contentRef]);\n  // 计算 navs 的 top 值\n  const [top, setTop] = useState();\n  const containerRef = useRef(null);\n  useEffect(() => {\n    const container = containerRef.current;\n    if (!container) return;\n    if (value) {\n      const rect = container.getBoundingClientRect();\n      setTop(rect.bottom);\n    }\n  }, [value]);\n  const changeActive = key => {\n    if (value === key) {\n      setValue(null);\n    } else {\n      setValue(key);\n    }\n  };\n  let popupForceRender = false;\n  const items = [];\n  const navs = React.Children.map(props.children, child => {\n    if (React.isValidElement(child)) {\n      const childProps = Object.assign(Object.assign({}, child.props), {\n        onClick: () => {\n          changeActive(child.key);\n        },\n        active: child.key === value,\n        arrow: child.props.arrow === undefined ? props.arrow : child.props.arrow\n      });\n      items.push(child);\n      if (child.props.forceRender) popupForceRender = true;\n      return cloneElement(child, childProps);\n    } else {\n      return child;\n    }\n  });\n  useImperativeHandle(ref, () => ({\n    close: () => {\n      setValue(null);\n    }\n  }), [setValue]);\n  return withNativeProps(props, React.createElement(\"div\", {\n    className: classNames(classPrefix, {\n      [`${classPrefix}-open`]: !!value\n    }),\n    ref: containerRef\n  }, React.createElement(\"div\", {\n    className: `${classPrefix}-nav`,\n    ref: navRef\n  }, navs), React.createElement(Popup, {\n    visible: !!value,\n    position: 'top',\n    className: `${classPrefix}-popup`,\n    maskClassName: `${classPrefix}-popup-mask`,\n    bodyClassName: `${classPrefix}-popup-body`,\n    style: {\n      top\n    },\n    forceRender: popupForceRender,\n    onMaskClick: props.closeOnMaskClick ? () => {\n      changeActive(null);\n    } : undefined\n  }, React.createElement(\"div\", {\n    ref: contentRef\n  }, items.map(item => {\n    const isActive = item.key === value;\n    return React.createElement(ItemChildrenWrap, {\n      key: item.key,\n      active: isActive,\n      forceRender: item.props.forceRender,\n      destroyOnClose: item.props.destroyOnClose\n    }, item.props.children);\n  })))));\n});\nexport default Dropdown;"],"mappings":"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"},"metadata":{},"sourceType":"module"}