{"ast":null,"code":"import React, { forwardRef, useImperativeHandle, useRef } from 'react';\nimport { useDrag } from '@use-gesture/react';\nimport { useSpring, animated } from '@react-spring/web';\nimport { Slide } from './slide';\nimport { convertPx } from '../../utils/convert-px';\nimport { bound } from '../../utils/bound';\nconst classPrefix = `adm-image-viewer`;\nexport const Slides = forwardRef((props, ref) => {\n  const slideWidth = window.innerWidth + convertPx(16);\n  const [{\n    x\n  }, api] = useSpring(() => ({\n    x: props.defaultIndex * slideWidth,\n    config: {\n      tension: 250,\n      clamp: true\n    }\n  }));\n  const count = props.images.length;\n  function swipeTo(index) {\n    let immediate = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n    var _a;\n    const i = bound(index, 0, count - 1);\n    (_a = props.onIndexChange) === null || _a === void 0 ? void 0 : _a.call(props, i);\n    api.start({\n      x: i * slideWidth,\n      immediate\n    });\n  }\n  useImperativeHandle(ref, () => ({\n    swipeTo\n  }));\n  const dragLockRef = useRef(false);\n  const bind = useDrag(state => {\n    if (dragLockRef.current) return;\n    const [offsetX] = state.offset;\n    if (state.last) {\n      const minIndex = Math.floor(offsetX / slideWidth);\n      const maxIndex = minIndex + 1;\n      const velocityOffset = Math.min(state.velocity[0] * 2000, slideWidth) * state.direction[0];\n      swipeTo(bound(Math.round((offsetX + velocityOffset) / slideWidth), minIndex, maxIndex));\n    } else {\n      api.start({\n        x: offsetX,\n        immediate: true\n      });\n    }\n  }, {\n    transform: _ref => {\n      let [x, y] = _ref;\n      return [-x, y];\n    },\n    from: () => [x.get(), 0],\n    bounds: () => {\n      return {\n        left: 0,\n        right: (count - 1) * slideWidth\n      };\n    },\n    rubberband: true,\n    axis: 'x',\n    pointer: {\n      touch: true\n    }\n  });\n  return React.createElement(\"div\", Object.assign({\n    className: `${classPrefix}-slides`\n  }, bind()), React.createElement(animated.div, {\n    className: `${classPrefix}-indicator`\n  }, x.to(v => {\n    const index = bound(Math.round(v / slideWidth), 0, count - 1);\n    return `${index + 1} / ${count}`;\n  })), React.createElement(animated.div, {\n    className: `${classPrefix}-slides-inner`,\n    style: {\n      x: x.to(x => -x)\n    }\n  }, props.images.map((image, index) => React.createElement(Slide, {\n    key: index,\n    image: image,\n    onTap: props.onTap,\n    maxZoom: props.maxZoom,\n    onZoomChange: zoom => {\n      if (zoom !== 1) {\n        const index = Math.round(x.get() / slideWidth);\n        api.start({\n          x: index * slideWidth\n        });\n      }\n    },\n    dragLockRef: dragLockRef\n  }))));\n});","map":{"version":3,"names":["React","forwardRef","useImperativeHandle","useRef","useDrag","useSpring","animated","Slide","convertPx","bound","classPrefix","Slides","props","ref","slideWidth","window","innerWidth","x","api","defaultIndex","config","tension","clamp","count","images","length","swipeTo","index","immediate","_a","i","onIndexChange","call","start","dragLockRef","bind","state","current","offsetX","offset","last","minIndex","Math","floor","maxIndex","velocityOffset","min","velocity","direction","round","transform","y","from","get","bounds","left","right","rubberband","axis","pointer","touch","createElement","Object","assign","className","div","to","v","style","map","image","key","onTap","maxZoom","onZoomChange","zoom"],"sources":["/Users/xinyonghu/Desktop/personalCode/react18-learn/xiaotaimei/node_modules/antd-mobile/es/components/image-viewer/slides.js"],"sourcesContent":["import React, { forwardRef, useImperativeHandle, useRef } from 'react';\nimport { useDrag } from '@use-gesture/react';\nimport { useSpring, animated } from '@react-spring/web';\nimport { Slide } from './slide';\nimport { convertPx } from '../../utils/convert-px';\nimport { bound } from '../../utils/bound';\nconst classPrefix = `adm-image-viewer`;\nexport const Slides = forwardRef((props, ref) => {\n  const slideWidth = window.innerWidth + convertPx(16);\n  const [{\n    x\n  }, api] = useSpring(() => ({\n    x: props.defaultIndex * slideWidth,\n    config: {\n      tension: 250,\n      clamp: true\n    }\n  }));\n  const count = props.images.length;\n  function swipeTo(index, immediate = false) {\n    var _a;\n    const i = bound(index, 0, count - 1);\n    (_a = props.onIndexChange) === null || _a === void 0 ? void 0 : _a.call(props, i);\n    api.start({\n      x: i * slideWidth,\n      immediate\n    });\n  }\n  useImperativeHandle(ref, () => ({\n    swipeTo\n  }));\n  const dragLockRef = useRef(false);\n  const bind = useDrag(state => {\n    if (dragLockRef.current) return;\n    const [offsetX] = state.offset;\n    if (state.last) {\n      const minIndex = Math.floor(offsetX / slideWidth);\n      const maxIndex = minIndex + 1;\n      const velocityOffset = Math.min(state.velocity[0] * 2000, slideWidth) * state.direction[0];\n      swipeTo(bound(Math.round((offsetX + velocityOffset) / slideWidth), minIndex, maxIndex));\n    } else {\n      api.start({\n        x: offsetX,\n        immediate: true\n      });\n    }\n  }, {\n    transform: ([x, y]) => [-x, y],\n    from: () => [x.get(), 0],\n    bounds: () => {\n      return {\n        left: 0,\n        right: (count - 1) * slideWidth\n      };\n    },\n    rubberband: true,\n    axis: 'x',\n    pointer: {\n      touch: true\n    }\n  });\n  return React.createElement(\"div\", Object.assign({\n    className: `${classPrefix}-slides`\n  }, bind()), React.createElement(animated.div, {\n    className: `${classPrefix}-indicator`\n  }, x.to(v => {\n    const index = bound(Math.round(v / slideWidth), 0, count - 1);\n    return `${index + 1} / ${count}`;\n  })), React.createElement(animated.div, {\n    className: `${classPrefix}-slides-inner`,\n    style: {\n      x: x.to(x => -x)\n    }\n  }, props.images.map((image, index) => React.createElement(Slide, {\n    key: index,\n    image: image,\n    onTap: props.onTap,\n    maxZoom: props.maxZoom,\n    onZoomChange: zoom => {\n      if (zoom !== 1) {\n        const index = Math.round(x.get() / slideWidth);\n        api.start({\n          x: index * slideWidth\n        });\n      }\n    },\n    dragLockRef: dragLockRef\n  }))));\n});"],"mappings":"AAAA,OAAOA,KAAK,IAAIC,UAAU,EAAEC,mBAAmB,EAAEC,MAAM,QAAQ,OAAO;AACtE,SAASC,OAAO,QAAQ,oBAAoB;AAC5C,SAASC,SAAS,EAAEC,QAAQ,QAAQ,mBAAmB;AACvD,SAASC,KAAK,QAAQ,SAAS;AAC/B,SAASC,SAAS,QAAQ,wBAAwB;AAClD,SAASC,KAAK,QAAQ,mBAAmB;AACzC,MAAMC,WAAW,GAAI,kBAAiB;AACtC,OAAO,MAAMC,MAAM,GAAGV,UAAU,CAAC,CAACW,KAAK,EAAEC,GAAG,KAAK;EAC/C,MAAMC,UAAU,GAAGC,MAAM,CAACC,UAAU,GAAGR,SAAS,CAAC,EAAE,CAAC;EACpD,MAAM,CAAC;IACLS;EACF,CAAC,EAAEC,GAAG,CAAC,GAAGb,SAAS,CAAC,OAAO;IACzBY,CAAC,EAAEL,KAAK,CAACO,YAAY,GAAGL,UAAU;IAClCM,MAAM,EAAE;MACNC,OAAO,EAAE,GAAG;MACZC,KAAK,EAAE;IACT;EACF,CAAC,CAAC,CAAC;EACH,MAAMC,KAAK,GAAGX,KAAK,CAACY,MAAM,CAACC,MAAM;EACjC,SAASC,OAAO,CAACC,KAAK,EAAqB;IAAA,IAAnBC,SAAS,uEAAG,KAAK;IACvC,IAAIC,EAAE;IACN,MAAMC,CAAC,GAAGrB,KAAK,CAACkB,KAAK,EAAE,CAAC,EAAEJ,KAAK,GAAG,CAAC,CAAC;IACpC,CAACM,EAAE,GAAGjB,KAAK,CAACmB,aAAa,MAAM,IAAI,IAAIF,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,EAAE,CAACG,IAAI,CAACpB,KAAK,EAAEkB,CAAC,CAAC;IACjFZ,GAAG,CAACe,KAAK,CAAC;MACRhB,CAAC,EAAEa,CAAC,GAAGhB,UAAU;MACjBc;IACF,CAAC,CAAC;EACJ;EACA1B,mBAAmB,CAACW,GAAG,EAAE,OAAO;IAC9Ba;EACF,CAAC,CAAC,CAAC;EACH,MAAMQ,WAAW,GAAG/B,MAAM,CAAC,KAAK,CAAC;EACjC,MAAMgC,IAAI,GAAG/B,OAAO,CAACgC,KAAK,IAAI;IAC5B,IAAIF,WAAW,CAACG,OAAO,EAAE;IACzB,MAAM,CAACC,OAAO,CAAC,GAAGF,KAAK,CAACG,MAAM;IAC9B,IAAIH,KAAK,CAACI,IAAI,EAAE;MACd,MAAMC,QAAQ,GAAGC,IAAI,CAACC,KAAK,CAACL,OAAO,GAAGxB,UAAU,CAAC;MACjD,MAAM8B,QAAQ,GAAGH,QAAQ,GAAG,CAAC;MAC7B,MAAMI,cAAc,GAAGH,IAAI,CAACI,GAAG,CAACV,KAAK,CAACW,QAAQ,CAAC,CAAC,CAAC,GAAG,IAAI,EAAEjC,UAAU,CAAC,GAAGsB,KAAK,CAACY,SAAS,CAAC,CAAC,CAAC;MAC1FtB,OAAO,CAACjB,KAAK,CAACiC,IAAI,CAACO,KAAK,CAAC,CAACX,OAAO,GAAGO,cAAc,IAAI/B,UAAU,CAAC,EAAE2B,QAAQ,EAAEG,QAAQ,CAAC,CAAC;IACzF,CAAC,MAAM;MACL1B,GAAG,CAACe,KAAK,CAAC;QACRhB,CAAC,EAAEqB,OAAO;QACVV,SAAS,EAAE;MACb,CAAC,CAAC;IACJ;EACF,CAAC,EAAE;IACDsB,SAAS,EAAE;MAAA,IAAC,CAACjC,CAAC,EAAEkC,CAAC,CAAC;MAAA,OAAK,CAAC,CAAClC,CAAC,EAAEkC,CAAC,CAAC;IAAA;IAC9BC,IAAI,EAAE,MAAM,CAACnC,CAAC,CAACoC,GAAG,EAAE,EAAE,CAAC,CAAC;IACxBC,MAAM,EAAE,MAAM;MACZ,OAAO;QACLC,IAAI,EAAE,CAAC;QACPC,KAAK,EAAE,CAACjC,KAAK,GAAG,CAAC,IAAIT;MACvB,CAAC;IACH,CAAC;IACD2C,UAAU,EAAE,IAAI;IAChBC,IAAI,EAAE,GAAG;IACTC,OAAO,EAAE;MACPC,KAAK,EAAE;IACT;EACF,CAAC,CAAC;EACF,OAAO5D,KAAK,CAAC6D,aAAa,CAAC,KAAK,EAAEC,MAAM,CAACC,MAAM,CAAC;IAC9CC,SAAS,EAAG,GAAEtD,WAAY;EAC5B,CAAC,EAAEyB,IAAI,EAAE,CAAC,EAAEnC,KAAK,CAAC6D,aAAa,CAACvD,QAAQ,CAAC2D,GAAG,EAAE;IAC5CD,SAAS,EAAG,GAAEtD,WAAY;EAC5B,CAAC,EAAEO,CAAC,CAACiD,EAAE,CAACC,CAAC,IAAI;IACX,MAAMxC,KAAK,GAAGlB,KAAK,CAACiC,IAAI,CAACO,KAAK,CAACkB,CAAC,GAAGrD,UAAU,CAAC,EAAE,CAAC,EAAES,KAAK,GAAG,CAAC,CAAC;IAC7D,OAAQ,GAAEI,KAAK,GAAG,CAAE,MAAKJ,KAAM,EAAC;EAClC,CAAC,CAAC,CAAC,EAAEvB,KAAK,CAAC6D,aAAa,CAACvD,QAAQ,CAAC2D,GAAG,EAAE;IACrCD,SAAS,EAAG,GAAEtD,WAAY,eAAc;IACxC0D,KAAK,EAAE;MACLnD,CAAC,EAAEA,CAAC,CAACiD,EAAE,CAACjD,CAAC,IAAI,CAACA,CAAC;IACjB;EACF,CAAC,EAAEL,KAAK,CAACY,MAAM,CAAC6C,GAAG,CAAC,CAACC,KAAK,EAAE3C,KAAK,KAAK3B,KAAK,CAAC6D,aAAa,CAACtD,KAAK,EAAE;IAC/DgE,GAAG,EAAE5C,KAAK;IACV2C,KAAK,EAAEA,KAAK;IACZE,KAAK,EAAE5D,KAAK,CAAC4D,KAAK;IAClBC,OAAO,EAAE7D,KAAK,CAAC6D,OAAO;IACtBC,YAAY,EAAEC,IAAI,IAAI;MACpB,IAAIA,IAAI,KAAK,CAAC,EAAE;QACd,MAAMhD,KAAK,GAAGe,IAAI,CAACO,KAAK,CAAChC,CAAC,CAACoC,GAAG,EAAE,GAAGvC,UAAU,CAAC;QAC9CI,GAAG,CAACe,KAAK,CAAC;UACRhB,CAAC,EAAEU,KAAK,GAAGb;QACb,CAAC,CAAC;MACJ;IACF,CAAC;IACDoB,WAAW,EAAEA;EACf,CAAC,CAAC,CAAC,CAAC,CAAC;AACP,CAAC,CAAC"},"metadata":{},"sourceType":"module"}