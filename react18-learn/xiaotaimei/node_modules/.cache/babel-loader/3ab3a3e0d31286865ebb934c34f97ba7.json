{"ast":null,"code":"import React, { useRef } from 'react';\nimport { useSpring, animated, to } from '@react-spring/web';\nimport { useDrag } from '@use-gesture/react';\nimport { mergeProps } from '../../utils/with-default-props';\nimport { withNativeProps } from '../../utils/native-props';\nconst classPrefix = `adm-floating-bubble`;\nconst defaultProps = {\n  axis: 'y'\n};\nexport const FloatingBubble = p => {\n  const props = mergeProps(defaultProps, p);\n  const boundaryRef = useRef(null);\n  const buttonRef = useRef(null);\n  /**\n   * memoize the `to` function\n   * inside a component that renders frequently\n   * to prevent an unintended restart\n   */\n  const [{\n    x,\n    y,\n    opacity\n  }, api] = useSpring(() => ({\n    x: 0,\n    y: 0,\n    opacity: 1\n  }));\n  const bind = useDrag(state => {\n    let nextX = state.offset[0];\n    let nextY = state.offset[1];\n    if (state.last && props.magnetic) {\n      const boundary = boundaryRef.current;\n      const button = buttonRef.current;\n      if (!boundary || !button) return;\n      const boundaryRect = boundary.getBoundingClientRect();\n      const buttonRect = button.getBoundingClientRect();\n      if (props.magnetic === 'x') {\n        const compensation = x.goal - x.get();\n        const leftDistance = buttonRect.left + compensation - boundaryRect.left;\n        const rightDistance = boundaryRect.right - (buttonRect.right + compensation);\n        if (rightDistance <= leftDistance) {\n          nextX += rightDistance;\n        } else {\n          nextX -= leftDistance;\n        }\n      } else if (props.magnetic === 'y') {\n        const compensation = y.goal - y.get();\n        const topDistance = buttonRect.top + compensation - boundaryRect.top;\n        const bottomDistance = boundaryRect.bottom - (buttonRect.bottom + compensation);\n        if (bottomDistance <= topDistance) {\n          nextY += bottomDistance;\n        } else {\n          nextY -= topDistance;\n        }\n      }\n    }\n    api.start({\n      x: nextX,\n      y: nextY\n    });\n    // active status\n    api.start({\n      opacity: state.active ? 0.8 : 1\n    });\n  }, {\n    axis: props.axis === 'xy' ? undefined : props.axis,\n    pointer: {\n      touch: true\n    },\n    // the component won't trigger drag logic if the user just clicked on the component.\n    filterTaps: true,\n    // set constraints to the user gesture\n    bounds: boundaryRef,\n    from: () => [x.get(), y.get()]\n  });\n  return withNativeProps(props, React.createElement(\"div\", {\n    className: classPrefix\n  }, React.createElement(\"div\", {\n    className: `${classPrefix}-boundary-outer`\n  }, React.createElement(\"div\", {\n    className: `${classPrefix}-boundary`,\n    ref: boundaryRef\n  })), React.createElement(animated.div, Object.assign({}, bind(), {\n    style: {\n      opacity,\n      transform: to([x, y], (x, y) => `translate(${x}px, ${y}px)`)\n    },\n    onClick: props.onClick,\n    className: `${classPrefix}-button`,\n    ref: buttonRef\n  }), props.children)));\n};","map":{"version":3,"names":["React","useRef","useSpring","animated","to","useDrag","mergeProps","withNativeProps","classPrefix","defaultProps","axis","FloatingBubble","p","props","boundaryRef","buttonRef","x","y","opacity","api","bind","state","nextX","offset","nextY","last","magnetic","boundary","current","button","boundaryRect","getBoundingClientRect","buttonRect","compensation","goal","get","leftDistance","left","rightDistance","right","topDistance","top","bottomDistance","bottom","start","active","undefined","pointer","touch","filterTaps","bounds","from","createElement","className","ref","div","Object","assign","style","transform","onClick","children"],"sources":["/Users/xinyonghu/Desktop/personalCode/react18-learn/xiaotaimei/node_modules/antd-mobile/es/components/floating-bubble/floating-bubble.js"],"sourcesContent":["import React, { useRef } from 'react';\nimport { useSpring, animated, to } from '@react-spring/web';\nimport { useDrag } from '@use-gesture/react';\nimport { mergeProps } from '../../utils/with-default-props';\nimport { withNativeProps } from '../../utils/native-props';\nconst classPrefix = `adm-floating-bubble`;\nconst defaultProps = {\n  axis: 'y'\n};\nexport const FloatingBubble = p => {\n  const props = mergeProps(defaultProps, p);\n  const boundaryRef = useRef(null);\n  const buttonRef = useRef(null);\n  /**\n   * memoize the `to` function\n   * inside a component that renders frequently\n   * to prevent an unintended restart\n   */\n  const [{\n    x,\n    y,\n    opacity\n  }, api] = useSpring(() => ({\n    x: 0,\n    y: 0,\n    opacity: 1\n  }));\n  const bind = useDrag(state => {\n    let nextX = state.offset[0];\n    let nextY = state.offset[1];\n    if (state.last && props.magnetic) {\n      const boundary = boundaryRef.current;\n      const button = buttonRef.current;\n      if (!boundary || !button) return;\n      const boundaryRect = boundary.getBoundingClientRect();\n      const buttonRect = button.getBoundingClientRect();\n      if (props.magnetic === 'x') {\n        const compensation = x.goal - x.get();\n        const leftDistance = buttonRect.left + compensation - boundaryRect.left;\n        const rightDistance = boundaryRect.right - (buttonRect.right + compensation);\n        if (rightDistance <= leftDistance) {\n          nextX += rightDistance;\n        } else {\n          nextX -= leftDistance;\n        }\n      } else if (props.magnetic === 'y') {\n        const compensation = y.goal - y.get();\n        const topDistance = buttonRect.top + compensation - boundaryRect.top;\n        const bottomDistance = boundaryRect.bottom - (buttonRect.bottom + compensation);\n        if (bottomDistance <= topDistance) {\n          nextY += bottomDistance;\n        } else {\n          nextY -= topDistance;\n        }\n      }\n    }\n    api.start({\n      x: nextX,\n      y: nextY\n    });\n    // active status\n    api.start({\n      opacity: state.active ? 0.8 : 1\n    });\n  }, {\n    axis: props.axis === 'xy' ? undefined : props.axis,\n    pointer: {\n      touch: true\n    },\n    // the component won't trigger drag logic if the user just clicked on the component.\n    filterTaps: true,\n    // set constraints to the user gesture\n    bounds: boundaryRef,\n    from: () => [x.get(), y.get()]\n  });\n  return withNativeProps(props, React.createElement(\"div\", {\n    className: classPrefix\n  }, React.createElement(\"div\", {\n    className: `${classPrefix}-boundary-outer`\n  }, React.createElement(\"div\", {\n    className: `${classPrefix}-boundary`,\n    ref: boundaryRef\n  })), React.createElement(animated.div, Object.assign({}, bind(), {\n    style: {\n      opacity,\n      transform: to([x, y], (x, y) => `translate(${x}px, ${y}px)`)\n    },\n    onClick: props.onClick,\n    className: `${classPrefix}-button`,\n    ref: buttonRef\n  }), props.children)));\n};"],"mappings":"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"},"metadata":{},"sourceType":"module"}