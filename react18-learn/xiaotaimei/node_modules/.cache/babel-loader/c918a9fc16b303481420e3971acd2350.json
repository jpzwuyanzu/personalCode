{"ast":null,"code":"import { mergeProps } from '../../utils/with-default-props';\nimport React, { useState, useRef } from 'react';\nimport { withNativeProps } from '../../utils/native-props';\nimport { staged } from 'staged-components';\nimport { toCSSLength } from '../../utils/to-css-length';\nimport { LazyDetector } from './lazy-detector';\nimport { useIsomorphicUpdateLayoutEffect } from '../../utils/use-isomorphic-update-layout-effect';\nimport { ImageIcon } from './image-icon';\nimport { BrokenImageIcon } from './broken-image-icon';\nconst classPrefix = `adm-image`;\nconst defaultProps = {\n  fit: 'fill',\n  placeholder: React.createElement(\"div\", {\n    className: `${classPrefix}-tip`\n  }, React.createElement(ImageIcon, null)),\n  fallback: React.createElement(\"div\", {\n    className: `${classPrefix}-tip`\n  }, React.createElement(BrokenImageIcon, null)),\n  lazy: false,\n  draggable: false\n};\nexport const Image = staged(p => {\n  const props = mergeProps(defaultProps, p);\n  const [loaded, setLoaded] = useState(false);\n  const [failed, setFailed] = useState(false);\n  const ref = useRef(null);\n  let src = props.src;\n  let srcSet = props.srcSet;\n  const [initialized, setInitialized] = useState(!props.lazy);\n  src = initialized ? props.src : undefined;\n  srcSet = initialized ? props.srcSet : undefined;\n  useIsomorphicUpdateLayoutEffect(() => {\n    setLoaded(false);\n    setFailed(false);\n  }, [src]);\n  function renderInner() {\n    if (failed) {\n      return React.createElement(React.Fragment, null, props.fallback);\n    }\n    const img = React.createElement(\"img\", {\n      className: `${classPrefix}-img`,\n      src: src,\n      alt: props.alt,\n      onClick: props.onClick,\n      onLoad: e => {\n        var _a;\n        setLoaded(true);\n        (_a = props.onLoad) === null || _a === void 0 ? void 0 : _a.call(props, e);\n      },\n      onError: e => {\n        var _a;\n        setFailed(true);\n        (_a = props.onError) === null || _a === void 0 ? void 0 : _a.call(props, e);\n      },\n      style: {\n        objectFit: props.fit,\n        display: loaded ? 'block' : 'none'\n      },\n      crossOrigin: props.crossOrigin,\n      decoding: props.decoding,\n      loading: props.loading,\n      referrerPolicy: props.referrerPolicy,\n      sizes: props.sizes,\n      srcSet: srcSet,\n      useMap: props.useMap,\n      draggable: props.draggable\n    });\n    return React.createElement(React.Fragment, null, !loaded && props.placeholder, img);\n  }\n  const style = {};\n  if (props.width) {\n    style['--width'] = toCSSLength(props.width);\n    style['width'] = toCSSLength(props.width);\n  }\n  if (props.height) {\n    style['--height'] = toCSSLength(props.height);\n    style['height'] = toCSSLength(props.height);\n  }\n  return withNativeProps(props, React.createElement(\"div\", {\n    ref: ref,\n    className: classPrefix,\n    style: style,\n    onClick: props.onContainerClick\n  }, props.lazy && !initialized && React.createElement(LazyDetector, {\n    onActive: () => {\n      setInitialized(true);\n    }\n  }), renderInner()));\n});","map":{"version":3,"names":["mergeProps","React","useState","useRef","withNativeProps","staged","toCSSLength","LazyDetector","useIsomorphicUpdateLayoutEffect","ImageIcon","BrokenImageIcon","classPrefix","defaultProps","fit","placeholder","createElement","className","fallback","lazy","draggable","Image","p","props","loaded","setLoaded","failed","setFailed","ref","src","srcSet","initialized","setInitialized","undefined","renderInner","Fragment","img","alt","onClick","onLoad","e","_a","call","onError","style","objectFit","display","crossOrigin","decoding","loading","referrerPolicy","sizes","useMap","width","height","onContainerClick","onActive"],"sources":["/Users/xinyonghu/Desktop/personalCode/react18-learn/xiaotaimei/node_modules/antd-mobile/es/components/image/image.js"],"sourcesContent":["import { mergeProps } from '../../utils/with-default-props';\nimport React, { useState, useRef } from 'react';\nimport { withNativeProps } from '../../utils/native-props';\nimport { staged } from 'staged-components';\nimport { toCSSLength } from '../../utils/to-css-length';\nimport { LazyDetector } from './lazy-detector';\nimport { useIsomorphicUpdateLayoutEffect } from '../../utils/use-isomorphic-update-layout-effect';\nimport { ImageIcon } from './image-icon';\nimport { BrokenImageIcon } from './broken-image-icon';\nconst classPrefix = `adm-image`;\nconst defaultProps = {\n  fit: 'fill',\n  placeholder: React.createElement(\"div\", {\n    className: `${classPrefix}-tip`\n  }, React.createElement(ImageIcon, null)),\n  fallback: React.createElement(\"div\", {\n    className: `${classPrefix}-tip`\n  }, React.createElement(BrokenImageIcon, null)),\n  lazy: false,\n  draggable: false\n};\nexport const Image = staged(p => {\n  const props = mergeProps(defaultProps, p);\n  const [loaded, setLoaded] = useState(false);\n  const [failed, setFailed] = useState(false);\n  const ref = useRef(null);\n  let src = props.src;\n  let srcSet = props.srcSet;\n  const [initialized, setInitialized] = useState(!props.lazy);\n  src = initialized ? props.src : undefined;\n  srcSet = initialized ? props.srcSet : undefined;\n  useIsomorphicUpdateLayoutEffect(() => {\n    setLoaded(false);\n    setFailed(false);\n  }, [src]);\n  function renderInner() {\n    if (failed) {\n      return React.createElement(React.Fragment, null, props.fallback);\n    }\n    const img = React.createElement(\"img\", {\n      className: `${classPrefix}-img`,\n      src: src,\n      alt: props.alt,\n      onClick: props.onClick,\n      onLoad: e => {\n        var _a;\n        setLoaded(true);\n        (_a = props.onLoad) === null || _a === void 0 ? void 0 : _a.call(props, e);\n      },\n      onError: e => {\n        var _a;\n        setFailed(true);\n        (_a = props.onError) === null || _a === void 0 ? void 0 : _a.call(props, e);\n      },\n      style: {\n        objectFit: props.fit,\n        display: loaded ? 'block' : 'none'\n      },\n      crossOrigin: props.crossOrigin,\n      decoding: props.decoding,\n      loading: props.loading,\n      referrerPolicy: props.referrerPolicy,\n      sizes: props.sizes,\n      srcSet: srcSet,\n      useMap: props.useMap,\n      draggable: props.draggable\n    });\n    return React.createElement(React.Fragment, null, !loaded && props.placeholder, img);\n  }\n  const style = {};\n  if (props.width) {\n    style['--width'] = toCSSLength(props.width);\n    style['width'] = toCSSLength(props.width);\n  }\n  if (props.height) {\n    style['--height'] = toCSSLength(props.height);\n    style['height'] = toCSSLength(props.height);\n  }\n  return withNativeProps(props, React.createElement(\"div\", {\n    ref: ref,\n    className: classPrefix,\n    style: style,\n    onClick: props.onContainerClick\n  }, props.lazy && !initialized && React.createElement(LazyDetector, {\n    onActive: () => {\n      setInitialized(true);\n    }\n  }), renderInner()));\n});"],"mappings":"AAAA,SAASA,UAAU,QAAQ,gCAAgC;AAC3D,OAAOC,KAAK,IAAIC,QAAQ,EAAEC,MAAM,QAAQ,OAAO;AAC/C,SAASC,eAAe,QAAQ,0BAA0B;AAC1D,SAASC,MAAM,QAAQ,mBAAmB;AAC1C,SAASC,WAAW,QAAQ,2BAA2B;AACvD,SAASC,YAAY,QAAQ,iBAAiB;AAC9C,SAASC,+BAA+B,QAAQ,iDAAiD;AACjG,SAASC,SAAS,QAAQ,cAAc;AACxC,SAASC,eAAe,QAAQ,qBAAqB;AACrD,MAAMC,WAAW,GAAI,WAAU;AAC/B,MAAMC,YAAY,GAAG;EACnBC,GAAG,EAAE,MAAM;EACXC,WAAW,EAAEb,KAAK,CAACc,aAAa,CAAC,KAAK,EAAE;IACtCC,SAAS,EAAG,GAAEL,WAAY;EAC5B,CAAC,EAAEV,KAAK,CAACc,aAAa,CAACN,SAAS,EAAE,IAAI,CAAC,CAAC;EACxCQ,QAAQ,EAAEhB,KAAK,CAACc,aAAa,CAAC,KAAK,EAAE;IACnCC,SAAS,EAAG,GAAEL,WAAY;EAC5B,CAAC,EAAEV,KAAK,CAACc,aAAa,CAACL,eAAe,EAAE,IAAI,CAAC,CAAC;EAC9CQ,IAAI,EAAE,KAAK;EACXC,SAAS,EAAE;AACb,CAAC;AACD,OAAO,MAAMC,KAAK,GAAGf,MAAM,CAACgB,CAAC,IAAI;EAC/B,MAAMC,KAAK,GAAGtB,UAAU,CAACY,YAAY,EAAES,CAAC,CAAC;EACzC,MAAM,CAACE,MAAM,EAAEC,SAAS,CAAC,GAAGtB,QAAQ,CAAC,KAAK,CAAC;EAC3C,MAAM,CAACuB,MAAM,EAAEC,SAAS,CAAC,GAAGxB,QAAQ,CAAC,KAAK,CAAC;EAC3C,MAAMyB,GAAG,GAAGxB,MAAM,CAAC,IAAI,CAAC;EACxB,IAAIyB,GAAG,GAAGN,KAAK,CAACM,GAAG;EACnB,IAAIC,MAAM,GAAGP,KAAK,CAACO,MAAM;EACzB,MAAM,CAACC,WAAW,EAAEC,cAAc,CAAC,GAAG7B,QAAQ,CAAC,CAACoB,KAAK,CAACJ,IAAI,CAAC;EAC3DU,GAAG,GAAGE,WAAW,GAAGR,KAAK,CAACM,GAAG,GAAGI,SAAS;EACzCH,MAAM,GAAGC,WAAW,GAAGR,KAAK,CAACO,MAAM,GAAGG,SAAS;EAC/CxB,+BAA+B,CAAC,MAAM;IACpCgB,SAAS,CAAC,KAAK,CAAC;IAChBE,SAAS,CAAC,KAAK,CAAC;EAClB,CAAC,EAAE,CAACE,GAAG,CAAC,CAAC;EACT,SAASK,WAAW,GAAG;IACrB,IAAIR,MAAM,EAAE;MACV,OAAOxB,KAAK,CAACc,aAAa,CAACd,KAAK,CAACiC,QAAQ,EAAE,IAAI,EAAEZ,KAAK,CAACL,QAAQ,CAAC;IAClE;IACA,MAAMkB,GAAG,GAAGlC,KAAK,CAACc,aAAa,CAAC,KAAK,EAAE;MACrCC,SAAS,EAAG,GAAEL,WAAY,MAAK;MAC/BiB,GAAG,EAAEA,GAAG;MACRQ,GAAG,EAAEd,KAAK,CAACc,GAAG;MACdC,OAAO,EAAEf,KAAK,CAACe,OAAO;MACtBC,MAAM,EAAEC,CAAC,IAAI;QACX,IAAIC,EAAE;QACNhB,SAAS,CAAC,IAAI,CAAC;QACf,CAACgB,EAAE,GAAGlB,KAAK,CAACgB,MAAM,MAAM,IAAI,IAAIE,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,EAAE,CAACC,IAAI,CAACnB,KAAK,EAAEiB,CAAC,CAAC;MAC5E,CAAC;MACDG,OAAO,EAAEH,CAAC,IAAI;QACZ,IAAIC,EAAE;QACNd,SAAS,CAAC,IAAI,CAAC;QACf,CAACc,EAAE,GAAGlB,KAAK,CAACoB,OAAO,MAAM,IAAI,IAAIF,EAAE,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,EAAE,CAACC,IAAI,CAACnB,KAAK,EAAEiB,CAAC,CAAC;MAC7E,CAAC;MACDI,KAAK,EAAE;QACLC,SAAS,EAAEtB,KAAK,CAACT,GAAG;QACpBgC,OAAO,EAAEtB,MAAM,GAAG,OAAO,GAAG;MAC9B,CAAC;MACDuB,WAAW,EAAExB,KAAK,CAACwB,WAAW;MAC9BC,QAAQ,EAAEzB,KAAK,CAACyB,QAAQ;MACxBC,OAAO,EAAE1B,KAAK,CAAC0B,OAAO;MACtBC,cAAc,EAAE3B,KAAK,CAAC2B,cAAc;MACpCC,KAAK,EAAE5B,KAAK,CAAC4B,KAAK;MAClBrB,MAAM,EAAEA,MAAM;MACdsB,MAAM,EAAE7B,KAAK,CAAC6B,MAAM;MACpBhC,SAAS,EAAEG,KAAK,CAACH;IACnB,CAAC,CAAC;IACF,OAAOlB,KAAK,CAACc,aAAa,CAACd,KAAK,CAACiC,QAAQ,EAAE,IAAI,EAAE,CAACX,MAAM,IAAID,KAAK,CAACR,WAAW,EAAEqB,GAAG,CAAC;EACrF;EACA,MAAMQ,KAAK,GAAG,CAAC,CAAC;EAChB,IAAIrB,KAAK,CAAC8B,KAAK,EAAE;IACfT,KAAK,CAAC,SAAS,CAAC,GAAGrC,WAAW,CAACgB,KAAK,CAAC8B,KAAK,CAAC;IAC3CT,KAAK,CAAC,OAAO,CAAC,GAAGrC,WAAW,CAACgB,KAAK,CAAC8B,KAAK,CAAC;EAC3C;EACA,IAAI9B,KAAK,CAAC+B,MAAM,EAAE;IAChBV,KAAK,CAAC,UAAU,CAAC,GAAGrC,WAAW,CAACgB,KAAK,CAAC+B,MAAM,CAAC;IAC7CV,KAAK,CAAC,QAAQ,CAAC,GAAGrC,WAAW,CAACgB,KAAK,CAAC+B,MAAM,CAAC;EAC7C;EACA,OAAOjD,eAAe,CAACkB,KAAK,EAAErB,KAAK,CAACc,aAAa,CAAC,KAAK,EAAE;IACvDY,GAAG,EAAEA,GAAG;IACRX,SAAS,EAAEL,WAAW;IACtBgC,KAAK,EAAEA,KAAK;IACZN,OAAO,EAAEf,KAAK,CAACgC;EACjB,CAAC,EAAEhC,KAAK,CAACJ,IAAI,IAAI,CAACY,WAAW,IAAI7B,KAAK,CAACc,aAAa,CAACR,YAAY,EAAE;IACjEgD,QAAQ,EAAE,MAAM;MACdxB,cAAc,CAAC,IAAI,CAAC;IACtB;EACF,CAAC,CAAC,EAAEE,WAAW,EAAE,CAAC,CAAC;AACrB,CAAC,CAAC"},"metadata":{},"sourceType":"module"}