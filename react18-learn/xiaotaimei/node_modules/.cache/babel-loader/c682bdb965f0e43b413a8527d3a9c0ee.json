{"ast":null,"code":"var __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n    r,\n    ar = [],\n    e;\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) {\n      ar.push(r.value);\n    }\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n  return ar;\n};\nimport { useEffect, useMemo, useState, useRef } from 'react';\nimport useEventListener from '../useEventListener';\nimport useLatest from '../useLatest';\nimport useMemoizedFn from '../useMemoizedFn';\nimport useSize from '../useSize';\nimport { getTargetElement } from '../utils/domTarget';\nimport { isNumber } from '../utils';\nvar useVirtualList = function useVirtualList(list, options) {\n  var containerTarget = options.containerTarget,\n    wrapperTarget = options.wrapperTarget,\n    itemHeight = options.itemHeight,\n    _a = options.overscan,\n    overscan = _a === void 0 ? 5 : _a;\n  var itemHeightRef = useLatest(itemHeight);\n  var size = useSize(containerTarget);\n  var scrollTriggerByScrollToFunc = useRef(false);\n  var _b = __read(useState([]), 2),\n    targetList = _b[0],\n    setTargetList = _b[1];\n  var getVisibleCount = function getVisibleCount(containerHeight, fromIndex) {\n    if (isNumber(itemHeightRef.current)) {\n      return Math.ceil(containerHeight / itemHeightRef.current);\n    }\n    var sum = 0;\n    var endIndex = 0;\n    for (var i = fromIndex; i < list.length; i++) {\n      var height = itemHeightRef.current(i, list[i]);\n      sum += height;\n      endIndex = i;\n      if (sum >= containerHeight) {\n        break;\n      }\n    }\n    return endIndex - fromIndex;\n  };\n  var getOffset = function getOffset(scrollTop) {\n    if (isNumber(itemHeightRef.current)) {\n      return Math.floor(scrollTop / itemHeightRef.current) + 1;\n    }\n    var sum = 0;\n    var offset = 0;\n    for (var i = 0; i < list.length; i++) {\n      var height = itemHeightRef.current(i, list[i]);\n      sum += height;\n      if (sum >= scrollTop) {\n        offset = i;\n        break;\n      }\n    }\n    return offset + 1;\n  };\n  // 获取上部高度\n  var getDistanceTop = function getDistanceTop(index) {\n    if (isNumber(itemHeightRef.current)) {\n      var height_1 = index * itemHeightRef.current;\n      return height_1;\n    }\n    var height = list.slice(0, index).reduce(function (sum, _, i) {\n      return sum + itemHeightRef.current(i, list[i]);\n    }, 0);\n    return height;\n  };\n  var totalHeight = useMemo(function () {\n    if (isNumber(itemHeightRef.current)) {\n      return list.length * itemHeightRef.current;\n    }\n    return list.reduce(function (sum, _, index) {\n      return sum + itemHeightRef.current(index, list[index]);\n    }, 0);\n  }, [list]);\n  var calculateRange = function calculateRange() {\n    var container = getTargetElement(containerTarget);\n    var wrapper = getTargetElement(wrapperTarget);\n    if (container && wrapper) {\n      var scrollTop = container.scrollTop,\n        clientHeight = container.clientHeight;\n      var offset = getOffset(scrollTop);\n      var visibleCount = getVisibleCount(clientHeight, offset);\n      var start_1 = Math.max(0, offset - overscan);\n      var end = Math.min(list.length, offset + visibleCount + overscan);\n      var offsetTop = getDistanceTop(start_1);\n      wrapper.style.height = totalHeight - offsetTop + 'px';\n      wrapper.style.marginTop = offsetTop + 'px';\n      setTargetList(list.slice(start_1, end).map(function (ele, index) {\n        return {\n          data: ele,\n          index: index + start_1\n        };\n      }));\n    }\n  };\n  useEffect(function () {\n    if (!(size === null || size === void 0 ? void 0 : size.width) || !(size === null || size === void 0 ? void 0 : size.height)) {\n      return;\n    }\n    calculateRange();\n  }, [size === null || size === void 0 ? void 0 : size.width, size === null || size === void 0 ? void 0 : size.height, list]);\n  useEventListener('scroll', function (e) {\n    if (scrollTriggerByScrollToFunc.current) {\n      scrollTriggerByScrollToFunc.current = false;\n      return;\n    }\n    e.preventDefault();\n    calculateRange();\n  }, {\n    target: containerTarget\n  });\n  var scrollTo = function scrollTo(index) {\n    var container = getTargetElement(containerTarget);\n    if (container) {\n      scrollTriggerByScrollToFunc.current = true;\n      container.scrollTop = getDistanceTop(index);\n      calculateRange();\n    }\n  };\n  return [targetList, useMemoizedFn(scrollTo)];\n};\nexport default useVirtualList;","map":{"version":3,"names":["__read","o","n","m","Symbol","iterator","i","call","r","ar","e","next","done","push","value","error","useEffect","useMemo","useState","useRef","useEventListener","useLatest","useMemoizedFn","useSize","getTargetElement","isNumber","useVirtualList","list","options","containerTarget","wrapperTarget","itemHeight","_a","overscan","itemHeightRef","size","scrollTriggerByScrollToFunc","_b","targetList","setTargetList","getVisibleCount","containerHeight","fromIndex","current","Math","ceil","sum","endIndex","length","height","getOffset","scrollTop","floor","offset","getDistanceTop","index","height_1","slice","reduce","_","totalHeight","calculateRange","container","wrapper","clientHeight","visibleCount","start_1","max","end","min","offsetTop","style","marginTop","map","ele","data","width","preventDefault","target","scrollTo"],"sources":["/Users/xinyonghu/Desktop/personalCode/react18-learn/xiaotaimei/node_modules/ahooks/es/useVirtualList/index.js"],"sourcesContent":["var __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n    r,\n    ar = [],\n    e;\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) {\n      ar.push(r.value);\n    }\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n  return ar;\n};\nimport { useEffect, useMemo, useState, useRef } from 'react';\nimport useEventListener from '../useEventListener';\nimport useLatest from '../useLatest';\nimport useMemoizedFn from '../useMemoizedFn';\nimport useSize from '../useSize';\nimport { getTargetElement } from '../utils/domTarget';\nimport { isNumber } from '../utils';\nvar useVirtualList = function useVirtualList(list, options) {\n  var containerTarget = options.containerTarget,\n    wrapperTarget = options.wrapperTarget,\n    itemHeight = options.itemHeight,\n    _a = options.overscan,\n    overscan = _a === void 0 ? 5 : _a;\n  var itemHeightRef = useLatest(itemHeight);\n  var size = useSize(containerTarget);\n  var scrollTriggerByScrollToFunc = useRef(false);\n  var _b = __read(useState([]), 2),\n    targetList = _b[0],\n    setTargetList = _b[1];\n  var getVisibleCount = function getVisibleCount(containerHeight, fromIndex) {\n    if (isNumber(itemHeightRef.current)) {\n      return Math.ceil(containerHeight / itemHeightRef.current);\n    }\n    var sum = 0;\n    var endIndex = 0;\n    for (var i = fromIndex; i < list.length; i++) {\n      var height = itemHeightRef.current(i, list[i]);\n      sum += height;\n      endIndex = i;\n      if (sum >= containerHeight) {\n        break;\n      }\n    }\n    return endIndex - fromIndex;\n  };\n  var getOffset = function getOffset(scrollTop) {\n    if (isNumber(itemHeightRef.current)) {\n      return Math.floor(scrollTop / itemHeightRef.current) + 1;\n    }\n    var sum = 0;\n    var offset = 0;\n    for (var i = 0; i < list.length; i++) {\n      var height = itemHeightRef.current(i, list[i]);\n      sum += height;\n      if (sum >= scrollTop) {\n        offset = i;\n        break;\n      }\n    }\n    return offset + 1;\n  };\n  // 获取上部高度\n  var getDistanceTop = function getDistanceTop(index) {\n    if (isNumber(itemHeightRef.current)) {\n      var height_1 = index * itemHeightRef.current;\n      return height_1;\n    }\n    var height = list.slice(0, index).reduce(function (sum, _, i) {\n      return sum + itemHeightRef.current(i, list[i]);\n    }, 0);\n    return height;\n  };\n  var totalHeight = useMemo(function () {\n    if (isNumber(itemHeightRef.current)) {\n      return list.length * itemHeightRef.current;\n    }\n    return list.reduce(function (sum, _, index) {\n      return sum + itemHeightRef.current(index, list[index]);\n    }, 0);\n  }, [list]);\n  var calculateRange = function calculateRange() {\n    var container = getTargetElement(containerTarget);\n    var wrapper = getTargetElement(wrapperTarget);\n    if (container && wrapper) {\n      var scrollTop = container.scrollTop,\n        clientHeight = container.clientHeight;\n      var offset = getOffset(scrollTop);\n      var visibleCount = getVisibleCount(clientHeight, offset);\n      var start_1 = Math.max(0, offset - overscan);\n      var end = Math.min(list.length, offset + visibleCount + overscan);\n      var offsetTop = getDistanceTop(start_1);\n      wrapper.style.height = totalHeight - offsetTop + 'px';\n      wrapper.style.marginTop = offsetTop + 'px';\n      setTargetList(list.slice(start_1, end).map(function (ele, index) {\n        return {\n          data: ele,\n          index: index + start_1\n        };\n      }));\n    }\n  };\n  useEffect(function () {\n    if (!(size === null || size === void 0 ? void 0 : size.width) || !(size === null || size === void 0 ? void 0 : size.height)) {\n      return;\n    }\n    calculateRange();\n  }, [size === null || size === void 0 ? void 0 : size.width, size === null || size === void 0 ? void 0 : size.height, list]);\n  useEventListener('scroll', function (e) {\n    if (scrollTriggerByScrollToFunc.current) {\n      scrollTriggerByScrollToFunc.current = false;\n      return;\n    }\n    e.preventDefault();\n    calculateRange();\n  }, {\n    target: containerTarget\n  });\n  var scrollTo = function scrollTo(index) {\n    var container = getTargetElement(containerTarget);\n    if (container) {\n      scrollTriggerByScrollToFunc.current = true;\n      container.scrollTop = getDistanceTop(index);\n      calculateRange();\n    }\n  };\n  return [targetList, useMemoizedFn(scrollTo)];\n};\nexport default useVirtualList;"],"mappings":"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"},"metadata":{},"sourceType":"module"}