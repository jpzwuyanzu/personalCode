{"ast":null,"code":"import React, { useEffect, useImperativeHandle, useRef, useState } from 'react';\nimport { renderToBody } from './render-to-body';\nexport function renderImperatively(element) {\n  const Wrapper = React.forwardRef((_, ref) => {\n    const [visible, setVisible] = useState(false);\n    const closedRef = useRef(false);\n    const [elementToRender, setElementToRender] = useState(element);\n    const keyRef = useRef(0);\n    useEffect(() => {\n      if (!closedRef.current) {\n        setVisible(true);\n      } else {\n        afterClose();\n      }\n    }, []);\n    function onClose() {\n      var _a, _b;\n      closedRef.current = true;\n      setVisible(false);\n      (_b = (_a = elementToRender.props).onClose) === null || _b === void 0 ? void 0 : _b.call(_a);\n    }\n    function afterClose() {\n      var _a, _b;\n      unmount();\n      (_b = (_a = elementToRender.props).afterClose) === null || _b === void 0 ? void 0 : _b.call(_a);\n    }\n    useImperativeHandle(ref, () => ({\n      close: onClose,\n      replace: element => {\n        var _a, _b;\n        keyRef.current++;\n        (_b = (_a = elementToRender.props).afterClose) === null || _b === void 0 ? void 0 : _b.call(_a);\n        setElementToRender(element);\n      }\n    }));\n    return React.cloneElement(elementToRender, Object.assign(Object.assign({}, elementToRender.props), {\n      key: keyRef.current,\n      visible,\n      onClose,\n      afterClose\n    }));\n  });\n  const wrapperRef = React.createRef();\n  const unmount = renderToBody(React.createElement(Wrapper, {\n    ref: wrapperRef\n  }));\n  return {\n    close: () => {\n      var _a;\n      (_a = wrapperRef.current) === null || _a === void 0 ? void 0 : _a.close();\n    },\n    replace: element => {\n      var _a;\n      (_a = wrapperRef.current) === null || _a === void 0 ? void 0 : _a.replace(element);\n    }\n  };\n}","map":{"version":3,"names":["React","useEffect","useImperativeHandle","useRef","useState","renderToBody","renderImperatively","element","Wrapper","forwardRef","_","ref","visible","setVisible","closedRef","elementToRender","setElementToRender","keyRef","current","afterClose","onClose","_a","_b","props","call","unmount","close","replace","cloneElement","Object","assign","key","wrapperRef","createRef","createElement"],"sources":["/Users/xinyonghu/Desktop/personalCode/react18-learn/xiaotaimei/node_modules/antd-mobile/es/utils/render-imperatively.js"],"sourcesContent":["import React, { useEffect, useImperativeHandle, useRef, useState } from 'react';\nimport { renderToBody } from './render-to-body';\nexport function renderImperatively(element) {\n  const Wrapper = React.forwardRef((_, ref) => {\n    const [visible, setVisible] = useState(false);\n    const closedRef = useRef(false);\n    const [elementToRender, setElementToRender] = useState(element);\n    const keyRef = useRef(0);\n    useEffect(() => {\n      if (!closedRef.current) {\n        setVisible(true);\n      } else {\n        afterClose();\n      }\n    }, []);\n    function onClose() {\n      var _a, _b;\n      closedRef.current = true;\n      setVisible(false);\n      (_b = (_a = elementToRender.props).onClose) === null || _b === void 0 ? void 0 : _b.call(_a);\n    }\n    function afterClose() {\n      var _a, _b;\n      unmount();\n      (_b = (_a = elementToRender.props).afterClose) === null || _b === void 0 ? void 0 : _b.call(_a);\n    }\n    useImperativeHandle(ref, () => ({\n      close: onClose,\n      replace: element => {\n        var _a, _b;\n        keyRef.current++;\n        (_b = (_a = elementToRender.props).afterClose) === null || _b === void 0 ? void 0 : _b.call(_a);\n        setElementToRender(element);\n      }\n    }));\n    return React.cloneElement(elementToRender, Object.assign(Object.assign({}, elementToRender.props), {\n      key: keyRef.current,\n      visible,\n      onClose,\n      afterClose\n    }));\n  });\n  const wrapperRef = React.createRef();\n  const unmount = renderToBody(React.createElement(Wrapper, {\n    ref: wrapperRef\n  }));\n  return {\n    close: () => {\n      var _a;\n      (_a = wrapperRef.current) === null || _a === void 0 ? void 0 : _a.close();\n    },\n    replace: element => {\n      var _a;\n      (_a = wrapperRef.current) === null || _a === void 0 ? void 0 : _a.replace(element);\n    }\n  };\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}